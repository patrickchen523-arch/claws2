---
name: long-task-monitor
description: 长任务进度主动汇报。当任务涉及超过3步工具调用时，每执行2个工具调用后主动向用户发送进度条消息。
---

# Skill: LongTaskMonitor

## 适用场景

当用户提出的任务满足以下任一条件时，必须启用本 Skill：

- 预计工具调用超过 3 步（如连续的 web_search、web_fetch、exec、read、edit 等）
- 任务涉及复杂逻辑、多文件操作、部署、爬取、分析等
- 预计耗时超过 1 分钟

## 执行逻辑

### 1. 任务初始化

在开始执行前，在脑中记录：
- 任务名称（简短，如"部署插件"、"抓取数据"、"代码重构"）
- 任务开始时间（用于估算耗时）
- 预计总步骤数

### 2. 周期性反馈规则

- 每执行完 **2 个工具调用**后，若任务尚未结束，必须调用 `message` 工具发送进度
- 严禁在工具调用循环中超过 **3 分钟**不给用户任何反馈
- 最终完成时发送完成消息

### 3. 进度消息格式

中间进度（严格按此格式）：

```
已执行当前任务：[任务名]
已耗时：约 [XX] 分钟
当前进度：[██████░░░░░░░░] [当前具体步骤描述]
```

进度条规则：
- 总长度 14 格
- `█` 表示已完成，`░` 表示未完成
- 根据已完成步骤数 / 预计总步骤数计算填充比例

完成消息：

```
✅ 任务完成：[任务名]
耗时：约 [XX] 分钟
```

### 4. 示例

任务"安装并配置 gitclaw"，预计 6 步，当前完成第 2 步：

```
已执行当前任务：安装并配置 gitclaw
已耗时：约 1 分钟
当前进度：[████░░░░░░░░░░] 已安装 gh CLI，正在初始化 git 仓库
```

### 5. 禁止行为

- 禁止连续执行超过 2 个工具调用而不发送进度
- 禁止在长任务中沉默超过 3 分钟
- 禁止用普通回复替代 `message` 工具发送进度（必须用 message 工具，确保 Telegram 能收到）

## 调用方式

发送进度时使用 `message` 工具：

```json
{
  "action": "send",
  "channel": "telegram",
  "target": "6739749199",
  "message": "已执行当前任务：...\n已耗时：约 X 分钟\n当前进度：[██████░░░░░░░░] ..."
}
```
